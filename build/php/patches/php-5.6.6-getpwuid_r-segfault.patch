diff -Nru php-5.6.6-orig/main/main.c php-5.6.6/main/main.c
--- php-5.6.6-orig/main/main.c	2015-02-18 21:45:59.000000000 +0200
+++ php-5.6.6/main/main.c	2015-02-25 22:43:16.480517809 +0200
@@ -1316,6 +1316,10 @@
 			efree(pwbuf);
 			return "";
 		}
+		if (retpwptr == NULL) {
+			efree(pwbuf);
+			return "";
+		}
 		pwd = &_pw;
 #else
 		if ((pwd=getpwuid(pstat->st_uid))==NULL) {
